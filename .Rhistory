limit 5
")
sqldf::sqldf("
SELECT Municipio, substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
* FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
limit 5 AND Municipio IS NOT NULL
")
sqldf::sqldf("
SELECT Municipio, substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
* FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL
limit 5
")
sqldf::sqldf("
SELECT Municipio, substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
* FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
* FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
--             limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
--             limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS , instr(EPS,' - ') AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
--             limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
--             limit 5
")
sqldf::sqldf("
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
--             limit 5
")
sqldf::sqldf("
-- DEF MATERNA: SI
WITH DEF_MAT_SI AS  (SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%')
SELECT * FROM DEF_MAT_SI
")
sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS pos
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE , ANIO
FROM Defuncion_Materna
)
SELECT * FROM ALL_DIVIPOLA_EPS
")
sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE , ANIO
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
")
sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
LEFT JOIN DEF_MAT_SI
ON DIVIPOLA_ = DIVIPOLA AND ANIO_ = ANIO
")
A = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
LEFT JOIN DEF_MAT_SI
ON DIVIPOLA_ = DIVIPOLA AND ANIO_ = ANIO AND EPS_CODE_ = EPS_CODE
")
View(A)
A = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)  ,
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
--    LEFT JOIN DEF_MAT_SI
--  ON DIVIPOLA_ = DIVIPOLA AND ANIO_ = ANIO AND EPS_CODE_ = EPS_CODE
")
DEF_MAT_SI = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_SI
")
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM MATERNA
")
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value AS Value, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
ALL_DIVIPOLA_EPS = sqldf::sqldf("
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
")
ALL_DIVIPOLA_EPS = sqldf::sqldf("
WITH
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
")
View(ALL_DIVIPOLA_EPS)
sqldf::sqldf("
SELECT * FROM ALL_DIVIPOLA_EPS
LEFT JOIN DEF_MAT_NO
ON DIVIPOLA_= DIVIPOLA AND Anio_ = Anio AND EPS_CODE_ = EPS_CODE_
")
temp = sqldf::sqldf("
SELECT * FROM ALL_DIVIPOLA_EPS
LEFT JOIN DEF_MAT_NO A
ON DIVIPOLA_= A.DIVIPOLA AND Anio_ = A.Anio AND EPS_CODE_ = A.EPS_CODE_
LEFT JOIN DEF_MAT_SI B
ON DIVIPOLA_= B.DIVIPOLA AND Anio_ = B.Anio AND EPS_CODE_ = B.EPS_CODE_
")
temp = sqldf::sqldf("
SELECT * FROM ALL_DIVIPOLA_EPS
LEFT JOIN DEF_MAT_NO A
ON DIVIPOLA_= A.DIVIPOLA AND Anio_ = A.Anio AND EPS_CODE_ = A.EPS_CODE
LEFT JOIN DEF_MAT_SI B
ON DIVIPOLA_= B.DIVIPOLA AND Anio_ = B.Anio AND EPS_CODE_ = B.EPS_CODE
")
View(temp)
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value , EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
DEF_MAT_SI = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value as def_mat_42d_si, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_SI
")
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
Defuncion_Materna_42_dias_value as def_mat_42d_no , EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna
WHERE  Defuncion_Materna_42_dias  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
temp = sqldf::sqldf("
SELECT c.* , def_mat_42d_no, def_mat_42d_si
FROM ALL_DIVIPOLA_EPS  c
LEFT JOIN DEF_MAT_NO A
ON DIVIPOLA_= A.DIVIPOLA AND Anio_ = A.Anio AND EPS_CODE_ = A.EPS_CODE
LEFT JOIN DEF_MAT_SI B
ON DIVIPOLA_= B.DIVIPOLA AND Anio_ = B.Anio AND EPS_CODE_ = B.EPS_CODE
")
View(temp)
View(Defuncion_Materna_1y)
#############################################
#Defuncion_Materna_1y
#############################################
colnames(Defuncion_Materna_1y) = c("Municipio", "Anio", "def_mat_1y_value" ,  "EPS" , "def_mat_1y" )
DEF_MAT_SI = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
def_mat_1y_value as def_mat_1y_si, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna_1y
WHERE  def_mat_1y  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_SI
")
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
def_mat_1y_value as def_mat_1y_si , EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna_1y
WHERE  def_mat_1y  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
ALL_DIVIPOLA_EPS = sqldf::sqldf("
WITH
ALL_DIVIPOLA_EPS AS (
SELECT DISTINCT substr(Municipio, 0, 6) DIVIPOLA_,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE_ , ANIO AS ANIO_
FROM Defuncion_Materna_1y
WHERE   Municipio IS NOT NULL AND ANIO IS NOT NULL
)
SELECT * FROM ALL_DIVIPOLA_EPS
")
DEF_MAT_SI = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_SI AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
def_mat_1y_value as def_mat_1y_si, EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna_1y
WHERE  def_mat_1y  LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_SI
")
DEF_MAT_NO = sqldf::sqldf("
-- DEF MATERNA: SI
WITH
DEF_MAT_NO AS  (
SELECT  substr(Municipio, 0, 6) DIVIPOLA,
substr(Municipio, 9, length(Municipio)) Muni  , Anio ,
def_mat_1y_value as def_mat_1y_no , EPS ,
substr(EPS, 0, instr(EPS,' - ') ) AS EPS_CODE
FROM Defuncion_Materna_1y
WHERE  def_mat_1y  NOT LIKE '%SI%'
AND Municipio IS NOT NULL AND ANIO IS NOT NULL
AND EPS NOT  LIKE '%NO DEF%'
)
SELECT * FROM DEF_MAT_NO
")
temp = sqldf::sqldf("
SELECT c.* ,  def_mat_1y_si, def_mat_1y_no
FROM temp  c
LEFT JOIN DEF_MAT_NO A
ON DIVIPOLA_= A.DIVIPOLA AND Anio_ = A.Anio AND EPS_CODE_ = A.EPS_CODE
LEFT JOIN DEF_MAT_SI B
ON DIVIPOLA_= B.DIVIPOLA AND Anio_ = B.Anio AND EPS_CODE_ = B.EPS_CODE
")
View(temp)
write.csv2(temp, paste0(path_output, 'Defuncion_Materna.csv'), row.names = F)
